# –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç STEP_1B –∫ STEP_1C

**–î–∞—Ç–∞:** 27 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ STEP_1B –∑–∞–≤–µ—Ä—à—ë–Ω, –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ STEP_1C

---

## ‚úÖ STEP_1B - –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **SQLAlchemy –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - ‚úÖ –í—Å–µ routes –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –Ω–∞ SQLAlchemy ORM
   - ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ raw sqlite3 –∑–∞–ø—Ä–æ—Å—ã
   - ‚úÖ SQLAlchemy –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ `create_app()`

2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π**
   - ‚úÖ Dev —Ä–µ–∂–∏–º: `utm_data.db` –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - ‚úÖ Prod —Ä–µ–∂–∏–º: `AppData/Roaming/UTMka/databases/utmka.db`
   - ‚úÖ –§—É–Ω–∫—Ü–∏–∏ `get_data_dir()`, `get_db_path()`, `get_resource_path()`

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**
   - ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ routes
   - ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `src/core/config.py`
   - ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ 34%

4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î
   - ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `history_new` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - ‚úÖ –ü–æ–ª–µ `user_email` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

## üìã STEP_1C - –ß—Ç–æ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç

### –¶–µ–ª—å:
–†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Web-–≤–µ—Ä—Å–∏–∏ —Å OAuth –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.

### –ó–∞–¥–∞—á–∏:

1. **–†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å User**
   - [ ] –î–æ–±–∞–≤–∏—Ç—å OAuth –ø–æ–ª—è: `google_id`, `yandex_id`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å: `name`, `avatar_url`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É: `subscription_type`, `subscription_expires_at`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `created_at`, `last_login_at`, `is_active`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `is_premium`

2. **–°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å Subscription**
   - [ ] –¢–∞–±–ª–∏—Ü–∞ `subscriptions`
   - [ ] –°–≤—è–∑—å —Å User —á–µ—Ä–µ–∑ `user_id` FK
   - [ ] –ü–æ–ª—è: `plan_type`, `started_at`, `expires_at`
   - [ ] –ü–ª–∞—Ç—ë–∂: `payment_provider`, `payment_id`, `amount`, `currency`
   - [ ] –°—Ç–∞—Ç—É—Å: `status`, `cancelled_at`

3. **–î–æ–±–∞–≤–∏—Ç—å WebConfig**
   - [ ] PostgreSQL URI –∏–∑ env
   - [ ] OAuth credentials (Google, –Ø–Ω–¥–µ–∫—Å)
   - [ ] Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (SMTP)
   - [ ] Payment providers (Stripe, –Æ–ö–∞—Å—Å–∞)
   - [ ] –õ–∏–º–∏—Ç—ã –¥–ª—è free/pro –ø–ª–∞–Ω–æ–≤

4. **–°–æ–∑–¥–∞—Ç—å ProductionConfig**
   - [ ] –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç WebConfig
   - [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ pool –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è PostgreSQL

5. **–î–æ–±–∞–≤–∏—Ç—å auth routes (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)**
   - [ ] `src/api/routes/auth.py`
   - [ ] –†–æ—É—Ç—ã: `/api/auth/login`, `/api/auth/oauth/google`, `/api/auth/oauth/yandex`, `/api/auth/me`
   - [ ] –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 501 (Not Implemented –¥–ª—è desktop)

6. **–û–±–Ω–æ–≤–∏—Ç—å create_app()**
   - [ ] –î–æ–±–∞–≤–∏—Ç—å 'web' –∏ 'production' –≤ configs
   - [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è auth_bp (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è desktop)

---

## üîÑ –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### Desktop –≤–µ—Ä—Å–∏—è (—Ç–µ–∫—É—â–∞—è):
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_email` (–Ω–µ `user_id`)
- ‚úÖ SQLite –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –ë–µ–∑ OAuth (email –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- ‚úÖ –ë–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫ (–≤—Å—ë –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ User

### Web –≤–µ—Ä—Å–∏—è (–±—É–¥—É—â–µ–µ):
- ‚è≥ OAuth —á–µ—Ä–µ–∑ Google/–Ø–Ω–¥–µ–∫—Å
- ‚è≥ PostgreSQL
- ‚è≥ –ü–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ Stripe/–Æ–ö–∞—Å—Å–∞
- ‚è≥ –õ–∏–º–∏—Ç—ã –¥–ª—è free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- ‚úÖ Desktop –∏ Web –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `src/core/`
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è `user_email` ‚Üí `user_id` –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –¥–æ –∑–∞–ø—É—Å–∫–∞ Web

---

## üìÅ –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –û–±–Ω–æ–≤–∏—Ç—å:
1. `src/core/models.py` ‚Äî —Ä–∞—Å—à–∏—Ä–∏—Ç—å User, –¥–æ–±–∞–≤–∏—Ç—å Subscription
2. `src/core/config.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å WebConfig, ProductionConfig
3. `src/api/__init__.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å 'web'/'production' –≤ configs

### –°–æ–∑–¥–∞—Ç—å:
1. `src/api/routes/auth.py` ‚Äî –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è OAuth —Ä–æ—É—Ç–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ STEP_1C

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è STEP_1C –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
# 1. –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
python3 -c "from src.api import create_app; app = create_app('web'); print('OK')"

# 2. –ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
python3 -c "
from src.core.models import User, Subscription
from src.api import create_app
app = create_app('development')
with app.app_context():
    from src.core.models import db
    print('Tables:', db.inspect(db.engine).get_table_names())
"

# 3. Desktop –∫–æ–Ω—Ñ–∏–≥ –Ω–µ —Å–ª–æ–º–∞–Ω
python3 -c "from src.api import create_app; app = create_app('desktop'); print('Desktop OK')"
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **STEP_1B:** `docs/migration/STEP_1B_SQLALCHEMY.md` ‚úÖ
- **STEP_1B Verification:** `docs/migration/STEP_1B_VERIFICATION.md` ‚úÖ
- **STEP_1C:** `docs/migration/STEP_1C_WEB_READY.md` ‚è≥
- **Main README:** `docs/migration/README.md` ‚úÖ

---

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ STEP_1C

**–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É STEP_1C!**

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è STEP_1B –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –º–æ–¥–µ–ª–µ–π –¥–ª—è Web-–≤–µ—Ä—Å–∏–∏.
