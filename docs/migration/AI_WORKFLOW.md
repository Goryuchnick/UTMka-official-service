# Гайд по работе с AI агентами в Cursor

## Введение

Этот гайд поможет эффективно использовать AI для работы над проектом UTMka. Описаны рекомендации по выбору моделей, формулировке задач и организации работы.

---

## Доступные модели в Cursor AI

### Топ-уровень (сложные архитектурные задачи)

| Модель | Лучше всего для | Скорость | Качество |
|--------|-----------------|----------|----------|
| **Opus 4.5** | Сложнейшие задачи, архитектура, рефакторинг | Медленная | Превосходное |
| **Composer 1** | Мульти-файловые изменения, агентная работа | Средняя | Превосходное |

### Высокий уровень (основная работа)

| Модель | Лучше всего для | Скорость | Качество |
|--------|-----------------|----------|----------|
| **Sonnet 4.5** | Сложные задачи, баланс качества и скорости | Средняя | Отличное |
| **GPT-5.2 Codex High** | Генерация кода высокого качества | Средняя | Отличное |
| **Gemini 3 Pro** | Сложные задачи, большой контекст | Средняя | Отличное |

### Средний уровень (повседневные задачи)

| Модель | Лучше всего для | Скорость | Качество |
|--------|-----------------|----------|----------|
| **Sonnet 4** | Стандартные задачи, рефакторинг | Быстрая | Хорошее |
| **GPT-5.2 Codex** | Генерация кода, автодополнение | Быстрая | Хорошее |
| **GPT-5.2** | Общие задачи, документация | Быстрая | Хорошее |
| **Grok Code** | Кодирование, отладка | Быстрая | Хорошее |

### Быстрые модели (простые задачи)

| Модель | Лучше всего для | Скорость | Качество |
|--------|-----------------|----------|----------|
| **Gemini 3 Flash** | Много мелких файлов, быстрые правки | Очень быстрая | Хорошее |
| **GPT-5.1 Codex Mini** | Простые правки, автодополнение | Очень быстрая | Базовое |
| **Haiku 4.5** | Мелкие задачи, быстрые ответы | Очень быстрая | Базовое |

---

## Рекомендации по этапам

### Этап 1: Реструктуризация

**Рекомендуемые модели:** Opus 4.5, Sonnet 4.5, Composer 1

**Почему:** Нужно понимание архитектуры, работа с несколькими файлами.

**Примеры промптов:**

```
Создай файл src/core/config.py с функциями get_data_dir() и get_db_path() 
по примеру из docs/migration/STEP_1_RESTRUCTURE.md
```

```
Перенеси модели из web/app/models/ в src/core/models.py, 
объединив в один файл. Сохрани все методы to_dict().
```

```
Создай src/api/__init__.py с функцией create_app() 
которая использует модели из src/core/
```

---

### Этап 2: Frontend

**Рекомендуемые модели:** Sonnet 4.5, Sonnet 4, Gemini 3 Flash

**Почему:** Много небольших файлов, повторяющиеся паттерны.

**Примеры промптов:**

```
Извлеки из index.html весь JavaScript код функции generateUTM 
и создай модуль frontend/js/components/generator.js
```

```
Создай frontend/js/api.js с функциями для работы с API:
- getHistory(email)
- addHistory(email, url)
- getTemplates(email)
- addTemplate(template)
Используй fetch и async/await.
```

```
Извлеки CSS стили из index.html в три файла:
- frontend/css/main.css (базовые стили, reset)
- frontend/css/components.css (карточки, кнопки, формы)
- frontend/css/utilities.css (flex, margin, padding утилиты)
```

---

### Этап 3: Windows Installer

**Рекомендуемые модели:** Opus 4.5, Sonnet 4.5, GPT-5.2 Codex

**Почему:** Специфичные знания PyInstaller и Inno Setup.

**Примеры промптов:**

```
Создай PyInstaller spec файл для UTMka с:
- Точка входа: src/desktop/main.py
- Включить папки: frontend/, assets/
- Исключить: tkinter, matplotlib, numpy
- Иконка: assets/logo/logoutm.ico
```

```
Создай Inno Setup скрипт который:
1. Устанавливает в Program Files
2. Создаёт папку данных в AppData
3. Создаёт ярлыки на рабочем столе
4. При удалении спрашивает удалять ли данные
```

---

### Этап 4: macOS

**Рекомендуемые модели:** Opus 4.5, Sonnet 4.5, GPT-5.2 Codex

**Примеры промптов:**

```
Адаптируй PyInstaller spec для macOS:
- BUNDLE для создания .app
- bundle_identifier: ru.utmka.desktop
- Поддержка Dark Mode
- Иконка .icns
```

```
Создай скрипт create_dmg.sh который:
- Создаёт DMG с приложением
- Добавляет ссылку на Applications
- Красивый фон (опционально)
```

---

## Режимы работы в Cursor

### Agent Mode (рекомендуется для большинства задач)

Включён по умолчанию. AI может:
- Читать файлы
- Создавать/редактировать файлы
- Запускать команды
- Работать с несколькими файлами

**Когда использовать:** Для всех задач кроме планирования.

### Plan Mode

AI только планирует, не вносит изменения.

**Когда использовать:**
- Обсуждение архитектуры
- Уточнение требований
- Составление плана работ

**Как включить:** Напишите "plan mode" или используйте команду `/plan`

### Ask Mode

AI только отвечает на вопросы, не меняет файлы.

**Когда использовать:**
- Вопросы по коду
- Объяснение концепций
- Поиск информации

---

## Эффективные промпты

### Структура хорошего промпта:

```
[Контекст] + [Задача] + [Ограничения/требования]
```

### Примеры:

**Плохо:**
```
Сделай API
```

**Хорошо:**
```
Создай Flask API в src/api/routes/history.py для работы с историей UTM-ссылок.
Эндпоинты:
- GET /history?user_email=... - получить историю
- POST /history - добавить запись (body: {user_email, url})
- DELETE /history/<id> - удалить запись

Используй модель HistoryLegacy из src/core/models.py.
Добавь валидацию через Marshmallow.
```

**Плохо:**
```
Исправь баг
```

**Хорошо:**
```
В файле frontend/js/components/generator.js функция handleSubmit 
не обрабатывает случай когда URL уже содержит параметры (?param=value).
Добавь проверку и корректное объединение параметров.
```

---

## Работа с контекстом (@mentions)

Cursor позволяет указывать контекст через @:

```
@src/core/models.py Добавь метод get_by_email в класс User
```

```
@docs/migration/STEP_2_FRONTEND.md Создай файлы по этой инструкции
```

```
@frontend/ Найди все места где используется fetch и замени на функции из api.js
```

---

## Типичные ошибки и решения

### Ошибка: AI создаёт слишком много кода сразу

**Решение:** Разбивайте задачи на мелкие части.

```
# Вместо:
"Создай весь frontend"

# Лучше:
"Создай frontend/js/api.js с функциями для работы с API"
"Создай frontend/js/state.js для управления состоянием"
"Создай frontend/js/components/generator.js"
```

### Ошибка: AI не понимает структуру проекта

**Решение:** Явно укажите пути и зависимости.

```
Создай src/api/routes/utm.py.
Импортируй модели из src.core.models (не из web.app.models).
Используй db из src.core.models.
```

### Ошибка: AI предлагает устаревшие решения

**Решение:** Укажите версии и требования.

```
Используй ES6 модули (import/export), не CommonJS (require).
Используй async/await, не callbacks.
Используй Flask 3.x синтаксис.
```

---

## Чек-листы для каждого этапа

### Перед началом работы:

- [ ] Прочитал инструкцию по этапу
- [ ] Выбрал подходящую модель
- [ ] Разбил задачу на подзадачи

### После завершения подзадачи:

- [ ] Проверил что код работает
- [ ] Нет ошибок линтера
- [ ] Импорты корректны
- [ ] Можно перейти к следующей подзадаче

### После завершения этапа:

- [ ] Все пункты чек-листа из инструкции выполнены
- [ ] Приложение запускается
- [ ] Основные функции работают

---

## Советы по продуктивности

### 1. Используйте Chat History

Cursor сохраняет историю чатов. Можно вернуться к предыдущему контексту.

### 2. Делайте коммиты после каждого этапа

```bash
git add .
git commit -m "Этап 1: Реструктуризация папок"
```

Это позволит откатиться если что-то пойдёт не так.

### 3. Тестируйте после каждого изменения

Не накапливайте изменения. Проверяйте что работает после каждой подзадачи.

### 4. Используйте Composer для сложных задач

Composer (Cmd+I / Ctrl+I) позволяет работать с несколькими файлами одновременно. Модель Composer 1 оптимизирована для мульти-файловых операций.

### 5. Сохраняйте удачные промпты

Если промпт дал хороший результат, сохраните его для будущего использования.

---

## Пример рабочей сессии

```
# Сессия 1: Создание структуры
1. Открыть Cursor
2. Выбрать Opus 4.5 или Composer 1
3. Промпт: "Создай структуру папок по docs/migration/ARCHITECTURE.md"
4. Проверить созданные папки
5. Коммит: "chore: создана структура папок"

# Сессия 2: Core модуль
1. Выбрать Sonnet 4.5
2. Промпт: "Создай src/core/config.py по инструкции из STEP_1"
3. Промпт: "Создай src/core/models.py, перенеси модели из web/app/models/"
4. Проверить импорты
5. Коммит: "feat: добавлен core модуль"

# Сессия 3: API
1. Выбрать Sonnet 4.5 или GPT-5.2 Codex
2. Промпт: "Создай src/api/__init__.py с create_app()"
3. Промпт: "Перенеси роуты из web/app/routes/ в src/api/routes/"
4. Исправить импорты
5. Протестировать API
6. Коммит: "feat: перенесён API в src/api"
```

---

## Резюме

| Этап | Рекомендуемые модели | Подход |
|------|---------------------|--------|
| 1. Реструктуризация | Opus 4.5, Sonnet 4.5, Composer 1 | Крупные задачи, архитектура |
| 2. Frontend | Sonnet 4.5, Sonnet 4, Gemini 3 Flash | Много мелких файлов |
| 3. Windows | Opus 4.5, Sonnet 4.5, GPT-5.2 Codex | Специфичные знания |
| 4. macOS | Opus 4.5, Sonnet 4.5, GPT-5.2 Codex | Специфичные знания |

**Главное правило:** Разбивайте задачи на мелкие части и проверяйте результат после каждой.
